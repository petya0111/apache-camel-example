<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xsi:schemaLocation=" http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                    http://camel.apache.org/schema/osgi
                    http://camel.apache.org/schema/osgi/camel-osgi.xsd
                    http://camel.apache.org/schema/spring
                    http://camel.apache.org/schema/spring/camel-spring.xsd
                    http://camel.apache.org/schema/cxf
                    http://camel.apache.org/schema/cxf/camel-cxf.xsd">
    <camel:camelContext id="camel">
        <camel:routeBuilder ref="fileMover"/>
        <camel:routeBuilder ref="contentBasedFileMover"/>
        <camel:routeBuilder ref="fileToQueueMover"/>
        <camel:routeBuilder ref="multipleDestinationDeliverer"/>
        <camel:routeBuilder ref="wireTapMover"/>
        <camel:routeBuilder ref="xstreamTransformingMover"/>
        <camel:routeBuilder ref="jaxbTransformingMover"/>
    </camel:camelContext>


    <bean id="xstream" class="com.thoughtworks.xstream.XStream"/>
    <bean id="bindyDataformat"
          class="org.apache.camel.dataformat.bindy.csv.BindyCsvDataFormat">
        <constructor-arg type="java.lang.String"
                         value="org.apache.camel.example.reportincident.model" />
    </bean>

    <bean id="csv" class="org.apache.camel.example.reportincident.beans.Csv" />
    <bean id="webService"
          class="org.apache.camel.example.reportincident.beans.WebService" />

    <!--
        <bean id="reportIncidentEndpoint"
        class="org.apache.camel.example.reportincident.ReportIncidentEndpoint"/>
-->

    <bean id="OK"
          class="org.apache.camel.example.reportincident.OutputReportIncident">
        <property name="code" value="0" />
    </bean>

    <bean id="activemq"
          class="org.apache.activemq.camel.component.ActiveMQComponent">
        <property name="brokerURL" value="vm://localhost:61616" />
    </bean>


    <!-- webservice endpoint  -->
    <cxf:cxfEndpoint id="reportIncident"
                     address="http://localhost:8080/camel-example/incident"
                     wsdlURL="wsdl/report_incident.wsdl"

                     serviceClass="org.apache.camel.example.reportincident.ReportIncidentEndpoint"
                     xmlns:s="http://reportincident.example.camel.apache.org">
    </cxf:cxfEndpoint>

    <camelContext trace="true" xmlns="http://camel.apache.org/schema/osgi">


        <camel:package>org.apache.camel.example.reportincident.routing</camel:package>

        <!-- File route  -->
        <camel:route>
            <camel:from     uri="file://d:/temp/data/?move=d:/temp/done/${file:name}" />
            <camel:unmarshal ref="bindyDataformat" />
            <camel:to uri="bean:csv" />
            <camel:to uri="activemq:queue:in" />
        </camel:route>

        <camel:route>
            <camel:from uri="activemq:queue:in" />
            <camel:to uri="file://d:/temp/data/queue/" />
        </camel:route>

    </camelContext>
</beans>
        